# 运行所有测试用例指南

由于Maven不在系统PATH中，推荐使用IDE来运行测试。

## 方式一：在IDE中运行所有测试（推荐）

### IntelliJ IDEA

1. **打开项目**
   - 打开 `backend` 目录作为项目根目录

2. **运行所有测试**
   - 方法1：右键点击 `src/test/java` 目录 -> Run 'All Tests'
   - 方法2：点击顶部菜单 Run -> Run 'All Tests'
   - 方法3：使用快捷键 `Ctrl+Shift+F10`（Windows）或 `Cmd+Shift+R`（Mac）

3. **运行特定测试类**
   - 在测试类上右键 -> Run 'TestClassName'
   - 或在测试类中点击类名旁边的绿色运行按钮

4. **运行特定测试方法**
   - 在测试方法上右键 -> Run 'testMethodName'
   - 或点击方法名旁边的绿色运行按钮

### Eclipse

1. **运行所有测试**
   - 右键点击 `src/test/java` 目录
   - Run As -> JUnit Test

2. **运行特定测试类**
   - 右键点击测试类文件
   - Run As -> JUnit Test

### VS Code

1. **安装Java Test Runner扩展**
   - 打开扩展面板（Ctrl+Shift+X）
   - 搜索 "Java Test Runner" 并安装

2. **运行测试**
   - 在测试文件或方法上会显示 "Run Test" 链接
   - 点击即可运行

## 方式二：如果已安装Maven，使用命令行

### Windows

```cmd
cd E:\Desktop\data-model\backend
mvn test
```

### Linux/Mac

```bash
cd /path/to/backend
mvn test
```

## 测试前的准备

### 1. 创建测试数据库

```sql
CREATE DATABASE datamodel_test;
```

### 2. 执行数据库初始化脚本

在 `datamodel_test` 数据库中执行：
```sql
-- 执行 backend/src/main/resources/db/migration/V1__Initial_schema.sql
```

### 3. 检查测试配置

确认 `src/test/resources/application-test.yml` 中的数据库配置正确：

```yaml
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/datamodel_test?...
    username: postgres
    password: postgres
```

## 预期测试结果

运行所有测试后，应该看到类似以下的结果：

```
✅ DataModelApplicationTests - contextLoads()
✅ ObjectTypeControllerTest - testCreateObjectType()
✅ ObjectTypeControllerTest - testCreateObjectTypeWithDuplicateName()
✅ ObjectTypeControllerTest - testGetObjectTypeById()
✅ ObjectTypeControllerTest - testGetObjectTypeByName()
✅ ObjectTypeControllerTest - testListObjectTypes()
✅ ObjectTypeControllerTest - testUpdateObjectType()
✅ ObjectTypeControllerTest - testDeleteObjectType()
✅ ObjectTypeControllerTest - testCreateObjectTypeWithInvalidData()
✅ PropertyControllerTest - testCreateProperty()
✅ PropertyControllerTest - testGetPropertyById()
✅ PropertyControllerTest - testGetPropertiesByObjectTypeId()
✅ PropertyControllerTest - testUpdateProperty()
✅ PropertyControllerTest - testDeleteProperty()
✅ PropertyControllerTest - testCreatePropertyWithDuplicateName()
✅ LinkTypeControllerTest - testCreateLinkType()
✅ LinkTypeControllerTest - testGetLinkTypeById()
✅ LinkTypeControllerTest - testGetLinkTypeByName()
✅ LinkTypeControllerTest - testGetLinkTypesByObjectTypeId()
✅ LinkTypeControllerTest - testUpdateLinkType()
✅ LinkTypeControllerTest - testDeleteLinkType()
✅ LinkTypeControllerTest - testCreateLinkTypeWithInvalidObjectType()
✅ InstanceControllerTest - testCreateInstance()
✅ InstanceControllerTest - testGetInstance()
✅ InstanceControllerTest - testListInstances()
✅ InstanceControllerTest - testUpdateInstance()
✅ InstanceControllerTest - testDeleteInstance()
✅ InstanceServiceTest - testCreateInstance()
✅ InstanceServiceTest - testGetInstance()
✅ InstanceServiceTest - testUpdateInstance()
✅ InstanceServiceTest - testListInstances()
✅ InstanceServiceTest - testListInstancesWithFilters()
✅ InstanceServiceTest - testDeleteInstance()
✅ InstanceServiceTest - testBatchDeleteInstances()
✅ InstanceServiceTest - testCreateInstanceWithRequiredField()
✅ InstanceServiceTest - testCreateInstanceWithDefaultValue()

Tests run: 33, Failures: 0, Errors: 0, Skipped: 0
```

## 查看测试报告

### IntelliJ IDEA

测试运行后，在底部会显示测试结果窗口：
- 绿色：测试通过
- 红色：测试失败
- 黄色：测试跳过

### Eclipse

在 JUnit 视图中查看测试结果：
- Window -> Show View -> Other -> Java -> JUnit

## 常见问题

### 1. 数据库连接失败

**错误**: `Connection refused` 或 `Authentication failed`

**解决**:
- 确保PostgreSQL服务正在运行
- 检查测试数据库是否已创建
- 验证 `application-test.yml` 中的数据库配置

### 2. 测试数据冲突

**错误**: 提示数据已存在或唯一约束冲突

**解决**:
- 测试会自动清理数据（使用 `@Transactional`）
- 如果仍有问题，手动清理测试数据库：
  ```sql
  TRUNCATE TABLE object_types CASCADE;
  ```

### 3. 表不存在错误

**错误**: `relation "object_types" does not exist`

**解决**:
- 确认已执行数据库初始化脚本
- 检查数据库名称是否正确（应该是 `datamodel_test`）

## 测试覆盖的功能

### API接口测试覆盖

- ✅ 对象类型管理 API（8个测试）
- ✅ 属性管理 API（6个测试）
- ✅ 链接类型管理 API（7个测试）
- ✅ 实例管理 API（5个测试）

### Service层测试覆盖

- ✅ 实例服务功能（8个测试）

### 总测试数

**约33个测试用例**，覆盖主要功能和边界情况。

## 下一步

测试通过后，可以：

1. 查看测试覆盖率报告
2. 添加更多边界情况测试
3. 添加性能测试
4. 添加集成测试

